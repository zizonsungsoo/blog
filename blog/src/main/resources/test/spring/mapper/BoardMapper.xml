<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-Mapper.dtd">
<mapper namespace="test.spring.mapper.BoardMapper">
	<insert id="insert">
		insert into board
		values(board_seq.nextval,#{writer},#{subject},#{email},#{content},#{password},sysdate,'0','0','0','0')
	</insert>
	<select id="boardAll"
		resultType="test.spring.component.BoardDTO">
		select * from board
		<where>
			<if test="writer != null">
				writer=#{writer}
			</if>
			<if test="num != null">
				and num=#{num}
			</if>
		</where>
	</select>
	<!-- 게시글 수정 -->
	<update id="update">
		update board
		<set>
			<if test="subject != null">subject=#{subject},</if>
			<if test="content != null">content=#{content}</if>
		</set>
		where num=#{num}
	</update>
	<!-- 조회수 올리기 -->
	<update id="updatereadcnt">
		update board set readcount=readcount+1 where
		num=#{num}
	</update>

	<delete id="delete">
		delete from board where num=#{num} and
		password=#{password}
	</delete>

	<!-- 총 게시글 갯수 출력 -->
	<select id="countBoard" resultType="int">
		SELECT COUNT(*) FROM BOARD
	</select>

	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="selectBoard"
		resultType="test.spring.component.BoardDTO">
		SELECT *
		FROM (
		SELECT ROWNUM RN, A.*
		FROM (
		SELECT *
		FROM BOARD
		ORDER BY num DESC
		) A
		)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>

<!-- 댓글 등록 -->
<insert id="insertBoardComment">
		insert into board_comment
		values(board_comment_seq.nextval,#{num},#{content},#{cwriter},sysdate)
	</insert>
<select id="boardConmmentAll" resultType="test.spring.component.Board_CommentDTO">
		select * from board_comment where num=#{num}
	</select>
	<select id="countBoardComment" resultType="int">
		SELECT COUNT(*) FROM board_comment where num=#{num}
	</select>
	<!-- 댓글 수정 -->
	<update id="updateBoardComment">
		update board_comment
		<set>
			<if test="content != null">content=#{content}</if>
		</set>
		where num=#{num}
	</update>
	<delete id="deleteBoardComment">
		delete from board_comment where num=#{num} and cwriter=#{cwriter}
	</delete>
</mapper>